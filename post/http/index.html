<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Http的进化 - Record the life</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="muxin" />
  <meta name="description" content="" />







<meta name="generator" content="Hugo 0.70.0" />


<link rel="canonical" href="http://mu-xin.github.io/post/http/" />



<link rel="icon" href="/fluidicon.png" />











<link rel="stylesheet" href="/sass/jane.min.06b243fac4668f09b63eac07ce36069187f227ab53d5acc9c92c28413cd1a177.css" integrity="sha256-BrJD&#43;sRmjwm2PqwHzjYGkYfyJ6tT1azJySwoQTzRoXc=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Http的进化" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://mu-xin.github.io/post/http/" />
<meta property="article:published_time" content="2019-07-04T21:30:21+08:00" />
<meta property="article:modified_time" content="2019-07-04T21:30:21+08:00" />
<meta itemprop="name" content="Http的进化">
<meta itemprop="description" content="">
<meta itemprop="datePublished" content="2019-07-04T21:30:21&#43;08:00" />
<meta itemprop="dateModified" content="2019-07-04T21:30:21&#43;08:00" />
<meta itemprop="wordCount" content="115">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Http的进化"/>
<meta name="twitter:description" content=""/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Record the life</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://mu-xin.github.io/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://mu-xin.github.io/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://mu-xin.github.io/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://mu-xin.github.io/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://mu-xin.github.io/about/">关于我</a>
          
        
      </li>
    
  </ul>
</nav>


  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Record the life
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://mu-xin.github.io/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://mu-xin.github.io/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://mu-xin.github.io/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://mu-xin.github.io/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://mu-xin.github.io/about/">关于我</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Http的进化</h1>
      
      <div class="post-meta">
        <time datetime="2019-07-04" class="post-time">
          2019-07-04
        </time>
        
        

        
        

        
        
      </div>
    </header>

    
    

    
    <div class="post-content">
      <p><img src="/http-squashed.png" alt="http"></p>
<p>近期在从头梳理个人技术栈,开始位置我想一定在http这块了,如果再向前扒那就太远了.借助搜索引擎找了一圈资料感觉收获颇丰,在此进行记录一番.
如有错误还请及时指出,避免误导大家.</p>
<hr>
<h3 id="http的发展历程">http的发展历程</h3>
<p>http其实是建立在OSI七层网络协议应用层的一个网络协议,同级别的还有ssh、ftp、sftp、telnet、smtp等,通常跑在 TCP/IP 协议栈之上，依靠 IP 协议实现寻址和路由、TCP 协议实现可靠数据传输、DNS 协议实现域名查找、SSL/TLS 协议实现安全通信。此外，还有一些协议依赖于 HTTP，例如 WebSocket、HTTPDNS 等。这些协议相互交织，构成了一个协议网，而 HTTP 则处于中心地位。</p>
<h3 id="http的进化历程">http的进化历程</h3>
<!-- raw HTML omitted -->
<p><strong>http/0.9</strong></p>
<!-- raw HTML omitted -->
<p><strong>http/1.0</strong></p>
<!-- raw HTML omitted -->
<ol>
<li>引入了请求头和响应头。request:(accept:accept-encoding:accept-language等)response:(content-encoding:content-type:等)</li>
<li>引入了响应状态码。</li>
<li>开始支持多种数据类型。</li>
<li>开始支持客户端通过POST方法向web服务器提交数据，支持GET、HEAD、POST方法。</li>
<li>支持长连接（但默认还是使用短连接,具体复用时间的长短可以由服务器控制，一般在15s左右）</li>
<li>加入缓存机制以及身份认证。</li>
</ol>
<!-- raw HTML omitted -->
<p><strong>http/1.1</strong></p>
<!-- raw HTML omitted -->
<p>HTTP/1.1相较于HTTP/1.0协议的区别主要体现在：</p>
<p>，并能很好地配合代理服务器工作。还支持以&quot;管道方式&quot;在同时发送多个请求，以便降低线路负载，提高传输速度。</p>
<ol>
<li>缓存处理,引入了实体标签，Cache-Control头。</li>
<li>默认为长连接,keep-alive和请求的流水线(管道化pipelining)处理,在一个tcp连接上可以传输多个http请求和响应(多路复用?),减少了建立和连接的消耗和延迟</li>
<li>范围请求功能,带宽优化及网络连接的使用,主要体现在支持文件断点续传</li>
<li>错误通知的管理,错误状态码的新增</li>
<li>消息在网络中的发送时,支持动态生成的内容,引入了Chunk transfer机制;服务器将数据分割成若干大小的数据块，每个数据块发送时都会附上数据块的长度，最后使用一个零长度的块来结束。这样就可以支持动态内容了。</li>
<li>互联网地址的维护,提供了虚拟主机的功能(HOST域)</li>
</ol>
<p>extra:
管道化机制必须通过永久连接完成,并且只有幂等的操作请求才可以进行管道化.有点类似于队列机制FIFO,但是如果头部请求操作对象过大时会造成管道阻塞.</p>
<!-- raw HTML omitted -->
<p><em>在http1.0被抱怨最多的就是连接无法复用</em></p>
<p>连接无法复用:会导致每次请求都经历三次握手和慢启动。要知道tcp的建立都要经历三次握手和满启动,在高延迟的场景下影响较明显，慢启动则对文件类的大请求影响较大。</p>
<p>对于http1.0的实现，在第一个请求没有收到回复之前，后续从应用层发出的请求只能排队，请求2，3，4，5只能等请求1的response回来之后才能逐个发出。网络通畅的时候性能影响不大，一旦请求1的request因为什么原因没有抵达服务器，或者response因为网络阻塞没有及时返回，影响的就是所有后续请求，问题就变得比较严重了。</p>
<p>http/1.1对于http/1.0连接无法复用的改进方式</p>
<ol>
<li>基于tcp的长连接
<ol>
<li>缺点:基于tcp的socket网络编程技术难度相对复杂的多,需要自己指定协议</li>
<li>优点:但是回报很大,信息交换很及时,在请求量爆发时还能减轻服务器的压力</li>
<li>example:google protobuf|json|xml|binary|thrift</li>
</ol>
</li>
<li>http long-poling (轮询)
<ol>
<li>缺点:数据通道单向、稳定性差</li>
<li>优点:服务器新数据产生后无需再次建立新的tcp连接</li>
</ol>
</li>
<li>http streaming(数据流长响应)
<ol>
<li>缺点:业务无法按照请求进行分割,一些代理服务器会等到服务器response结束后才会将结果推送到客户端,对于streaming这种长响应来说客户端会一只处于等待过程中.</li>
<li>优点:不会产生重复的header数据</li>
</ol>
</li>
<li>web socket
<ol>
<li>缺点:近些年才开始作为主流方案实时</li>
<li>优点:提供双工通道</li>
</ol>
</li>
</ol>
<p><strong>http2.0</strong></p>
<p>HTTP/2是HTTP协议自1999年HTTP 1.1发布后的首个更新，主要基于google 的SPDY协议。</p>
<p>记录2.0之前必须要提出google的SPDY协议</p>
<p><strong>需求:</strong></p>
<ol>
<li>降低延迟，客户端的单连接单请求，server的FIFO响应队列都是延迟的大头。</li>
<li>http最初设计都是客户端发起请求，然后server响应，server无法主动push内容到客户端。</li>
<li>压缩http header，http1.x的header越来越膨胀，cookie和user agent很容易让header的size增至1kb大小，甚至更多。而且由于http的无状态特性，header必须每次request都重复携带，很浪费流量。</li>
</ol>
<p><strong>基础功能:</strong></p>
<ol>
<li>多路复用</li>
<li>请求优先级</li>
<li>header压缩</li>
</ol>
<p><strong>高级功能:</strong></p>
<ol>
<li>server推送</li>
<li>server暗示</li>
</ol>
<p>HTTP2.0主要改动</p>
<!-- raw HTML omitted -->
<ol>
<li>新的二进制格式（Binary Format）</li>
<li>请求的优先级</li>
<li>服务器的推送</li>
<li>头部压缩
<ol>
<li>头信息使用zip或者compress进行压缩后再发送</li>
<li>客户端和服务器维护一张头信息表,所有字段都会存入这个表,生成一个索引号.后续的请求只需要发送一个索引号便可以高效率的进行数据的传输</li>
</ol>
</li>
</ol>
<!-- raw HTML omitted -->
<p><em>在http/1.1中使用了pipelining(管道化机制)不过pipelining并不是救世主，它也存在不少缺陷：</em></p>
<ol>
<li>head of blocking 是网络信息交互的罪魁祸首,头阻塞后健康的请求会被不健康的请求影响，而且这种体验的损耗受网络环境影响，出现随机且难以监控。</li>
<li>非幂等请求不能使用</li>
<li>很大部分的http代理服务器不支持pipelining</li>
<li>可能会导致新的Front of queue blocking问题</li>
</ol>
<blockquote>
<p>可以参考chrome对于pipeling的<a href="https://www.chromium.org/developers/design-documents/network-stack/http-pipelining">问题描述</a></p>
</blockquote>
<p>在http/2.0市场占有率逐步上升的时候也有其他的言论在:</p>
<p>“http2 是大倒退，GOOGLE搞出来的违反潮流的私货，会导致性能严重降低，最大的倒退就是把可读的文本协议变成二进制不可读，这是历史的大倒退,http json等技术为什么能成功流行很大一个因素是因为人类可读，HTTP2倒退到人类不可读绝对是反退货的设计，IT圣经&lt;黑客与画家》中早就一针见血地说过（程序写出来是给人看的,附带能在机器上运行。） 为什么BSON那些技术会失败,GOOGLE还没吸引教训，果不其然HTTP2还没开始正式使用就在搞HTTP3来擦屁股了,google用自己的技术霸权来带歪全世界也是有责任的”</p>
<p>“FreeBSD和Varnish cache的开发者保罗-恒宁·坎瀑批评称，这个标准文件的准备过程短得不切实际，而且未基于除了SPDY之外的任何协议，以至于其他协议失去了对草案进行改进的机会。”</p>
<p>“Kampala批评说，这个协议本身与HTTP不一致，而且还毫无必要地变得极为复杂。他还认为，这个协议违背了互联网协议的分层原则，例如说，将本属于TCP传输层的流控制(flow control)功能放入了协议中。”</p>
<blockquote>
<p>你我都是时代浪潮中的一员,技术本身是没有任何价值的,只有技术驱动社会的进步时才有具体的价值.</p>
</blockquote>
<p><strong>http3.0</strong></p>
<p>HTTP/3基于UDP协议实现了类似于TCP的多路复用数据流、传输可靠性等功能，这套功能被称为QUIC协议。</p>
<!-- raw HTML omitted -->
<ol>
<li>流量控制、传输可靠性功能:QUIC在UDP的基础上增加了一层来保证数据传输可靠性，它提供了数据包重传、拥塞控制、以及其他一些TCP中的特性。</li>
<li>集成TLS加密功能：目前QUIC使用TLS1.3，减少了握手所花费的RTT数。</li>
<li>多路复用：同一tcp连接上可以有多个独立的逻辑数据流，实现了数据流的单独传输，解决了TCP的队头阻塞问题。</li>
<li>快速握手：由于基于UDP，可以实现使用0 ~ 1个RTT来建立连接。</li>
</ol>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
    </div>

    
    

  
  



    
    

    <footer class="post-footer">
      

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/%E4%B8%89%E5%88%86%E9%92%9F%E4%BA%86%E8%A7%A3cgi_fastgi_php-fpm/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">三分钟了解CGI FastGI PHP-Fpm</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/%E4%BD%BF%E7%94%A8docker%E5%AE%9E%E7%8E%B0mysql%E7%9A%84%E4%B8%BB%E4%BB%8E/">
            <span class="next-text nav-default">使用Docker实现MySql的主从</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:jun771480011@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/mu-xin" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="http://mu-xin.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  

  <span class="copyright-year">
    &copy;
    
      2017 -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        muxin
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>


















</body>
</html>
